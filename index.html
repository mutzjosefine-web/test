<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fitness Tracker</title>
  <link rel="Fitness " href="Fitness.json">
  <style>

    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background-color: #d3d3d3; /* grauer Hintergrund */
    }

    .center-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      position: relative;
    }

    .gym-image {
      position: absolute;
      bottom: 0;
      width: 100%;
      max-height: 30vh;
      object-fit: cover;
    }

    .title {
      font-family: 'Montserrat', sans-serif;
      color: #ff69b4; /* pink */
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 30px;
    }

    .go-button {
      padding: 15px 50px;
      font-size: 24px;
      background-color: #ff1493;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
    }

    .go-button:hover {
      background-color: #e6008a;
    }

    .devices {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }

    .device {
      width: 80px;
      height: 80px;
      background-color: #fff;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    /* Eintragungsseite */
    #entryPage {
      display: none;
      padding: 20px;
        background-color: #d3d3d3;
        min-height: 100vh;
        max-width: 800px;
        margin: 0 auto;
    }

    #entryPage h1 {
      font-family: 'Montserrat', sans-serif;
      color: #ff69b4;
      text-align: center;
      font-size: 36px;
      margin-bottom: 30px;
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .form-label {
      display: block;
      margin-top: 15px;
      font-family: 'Montserrat', sans-serif;
      color: #ff1493; /* anderer Pink-Ton */
      font-size: 20px;
        background: white;
        padding: 10px;
        border-radius: 8px 8px 0 0;
        margin-bottom: 0;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      font-size: 18px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
        background: white;
        margin-top: 0;
        border-radius: 0 0 8px 8px;
        border-top: none;
        margin-bottom: 15px;
    }

    .submit-btn {
      margin-top: 20px;
      padding: 12px 30px;
      font-size: 20px;
      background-color: #ff1493;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
        width: 100%;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .submit-btn:hover {
      background-color: #e6008a;
    }

    /* Einträge anzeigen */
    #entries {
      margin-top: 30px;
      display: none;
    }

    .weekday-group {
      margin-bottom: 20px;
    }

    .weekday-title {
      font-family: 'Montserrat', sans-serif;
      color: #ff1493;
      font-size: 20px;
      font-weight: bold;
      margin: 15px 0 10px 0;
      padding-bottom: 5px;
      border-bottom: 2px solid #ff69b4;
    }

    .entry {
      background-color: #fff0f5;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .entry-buttons {
      display: flex;
      gap: 5px;
    }

    .edit-btn, .delete-btn {
      color: white;
      border: none;
      border-radius: 5px;
      padding: 5px 10px;
      cursor: pointer;
    }

    .edit-btn {
      background-color: #ff1493;
    }
    
    .edit-btn:hover {
      background-color: #e6008a;
    }

    .delete-btn {
      background-color: #dc3545;
    }

    .delete-btn:hover {
      background-color: #c82333;
    }

    /* Menü Button und Sidebar */
    #menuBtn {
      position: fixed;
      top: 20px;
      left: 20px;
      font-size: 24px;
      background-color: #ff1493;
      color: white;
      border: none;
      border-radius: 5px;
      width: 40px;
      height: 40px;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .hamburger-icon {
      width: 24px;
      height: 18px;
      position: relative;
      transform: rotate(0deg);
      transition: .5s ease-in-out;
    }

    .hamburger-icon span {
      display: block;
      position: absolute;
      height: 2px;
      width: 100%;
      background: white;
      border-radius: 2px;
      opacity: 1;
      left: 0;
      transform: rotate(0deg);
      transition: .25s ease-in-out;
    }

    .hamburger-icon span:nth-child(1) { top: 0px; }
    .hamburger-icon span:nth-child(2) { top: 8px; }
    .hamburger-icon span:nth-child(3) { top: 16px; }

    #menuBtn.hidden {
      display: none !important;
    }

    #sidebar {
      position: fixed;
      left: -300px;
      top: 0;
      width: 300px;
      height: 100vh;
      background: white;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      transition: left 0.3s ease;
      z-index: 999;
    }

    #sidebar.open {
      left: 0;
    }

    .sidebar-header {
      padding: 20px;
      background: #ff69b4;
      color: white;
      font-size: 24px;
      font-weight: bold;
    }

    .sidebar-content {
      padding: 20px;
    }

    .sidebar-section {
      margin-bottom: 30px;
    }

    .sidebar-section h2 {
      color: #ff1493;
      font-size: 18px;
      margin-bottom: 15px;
      padding: 10px;
      border-bottom: 2px solid #ff69b4;
      cursor: pointer;
      user-select: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff0f5;
      border-radius: 8px;
      transition: background-color 0.3s;
    }

    .sidebar-section h2:hover {
      background: #ffe4f0;
    }

    .toggle-icon {
      font-size: 14px;
      transition: transform 0.3s;
    }

    .toggle-icon.open {
      transform: rotate(180deg);
    }

    /* Kalender Styles */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-top: 10px;
      background-color: #d3d3d3; /* Grauer Hintergrund wie andere Seiten */
      padding: 10px;
      border-radius: 8px;
    }

    .calendar-header {
      grid-column: span 7;
      text-align: center;
      color: #ff1493;
      margin-bottom: 10px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .calendar-nav {
      cursor: pointer;
      background: none;
      border: none;
      color: #000; /* Pfeile schwarz */
      font-size: 20px;
      padding: 0 10px;
    }

    .calendar-nav:hover {
      color: #000;
    }

    .month-history {
      margin-top: 15px;
      max-height: 150px;
      overflow-y: auto;
    }

    .month-history-item {
      padding: 8px;
      margin-bottom: 5px;
      background: #f8f8f8;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }

    .month-history-item .stats {
      color: #ff1493;
    }

    .weekday {
      text-align: center;
      font-size: 12px;
      color: #666;
    }

    .day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      position: relative;
    }

    .day.active {
      position: relative;
      background-color: white;
      color: #ff1493;
      border-color: #ff1493;
    }
    
    .day.active::after {
      content: "✓";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #2ecc71; /* Ein schönes Grün */
      font-size: 20px;
      font-weight: bold;
    }

    .day.today {
      border-color: #ff1493;
      font-weight: bold;
    }

    .day.past {
      background-color: #f8f8f8;
    }

    /* Gewichtsauswahl (Zahnrad) */
    .gear-btn {
      background: #ff1493;
      color: white;
      border: none;
      border-radius: 8px;
      width: 56px;
      height: 56px;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .weight-control { position: relative; display: inline-flex; align-items: center; }

    /* Picker inline neben dem Zahnrad: wird per JS sichtbar geschaltet (display: flex) */
    .weight-picker {
      position: static;
      display: none; /* JS setzt 'flex' beim Öffnen */
      margin-left: 8px;
      background: white;
      border: 1px solid #ddd;
      padding: 6px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      z-index: 2000;
      min-width: 120px;
    }

    .spinner { display: flex; align-items: center; gap: 8px; }

    .spin-btn {
      background: #ff1493;
      color: #000; /* Pfeile schwarz */
      border: none;
      padding: 8px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    .spin-btn:active { transform: translateY(1px); }

    #weightSpinnerInput {
      width: 72px;
      font-size: 16px;
      text-align: center;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    /* Modal für Sätze-Eingabe */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2001;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-box {
      background: white;
      border-radius: 12px;
      padding: 24px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    .modal-header {
      font-family: 'Montserrat', sans-serif;
      font-size: 24px;
      color: #ff69b4;
      margin: 0 0 20px 0;
      font-weight: bold;
    }

    .modal-close-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #f0f0f0;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close-btn:hover {
      background: #e0e0e0;
    }

    .sets-input-group {
      margin-bottom: 16px;
    }

    .sets-input-label {
      font-family: 'Montserrat', sans-serif;
      color: #ff1493;
      font-size: 16px;
      margin-bottom: 8px;
      display: block;
      font-weight: bold;
    }

    .sets-input-field {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
      font-family: 'Montserrat', sans-serif;
    }

    .sets-input-field:focus {
      outline: none;
      border-color: #ff1493;
      box-shadow: 0 0 6px rgba(255, 20, 147, 0.3);
    }

    .sets-description {
      font-size: 13px;
      color: #666;
      margin-top: 6px;
    }

    .modal-footer {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      justify-content: flex-end;
    }

    .modal-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
    }

    .modal-btn-save {
      background: #ff1493;
      color: white;
    }

    .modal-btn-save:hover {
      background: #e6008a;
    }

    .modal-btn-cancel {
      background: #eee;
      color: #333;
    }

    .modal-btn-cancel:hover {
      background: #ddd;
    }

    /* Set-Details Modal */
    .sets-details-group {
      margin-bottom: 16px;
      padding: 12px;
      background: #f9f9f9;
      border-radius: 8px;
      border-left: 4px solid #ff1493;
    }

    .sets-details-label {
      font-weight: bold;
      color: #ff1493;
      font-size: 14px;
      margin-bottom: 8px;
      display: block;
    }

  </style>
</head>
<body>

  <!-- Startseite -->
  <div id="startPage" class="center-screen">
    <div class="title">Fitness Tracker</div>
    <button class="Start-button" onclick="goToEntry()">Start</button>

  </div>

  <!-- Sidebar -->
  <div id="sidebar">
    <div class="sidebar-header">Menü</div>
    <div class="sidebar-content">
      <div class="sidebar-section">
        <h2><a href="entries.html" style="color: #ff1393; text-decoration: none; display: block; padding: 10px; background: #fff0f5; border-radius: 8px;">Eintragungen →</a></h2>
      </div>
      <div class="sidebar-section">
        <h2>
          <a href="month_overview.html" style="color: #ff1393; text-decoration: none; display: block; padding: 10px; background: #fff0f5; border-radius: 8px;">Monatsübersicht →</a>
        </h2>
      </div>
    </div>
  </div>

  <!-- Eintragungsseite -->
  <div id="entryPage">
    <button id="menuBtn" onclick="toggleSidebar()">
      <div class="hamburger-icon">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>
    <h1>Eintragung</h1>

    <label class="form-label" for="dateInput">Datum</label>
    <input type="date" id="dateInput" style="width: 200px;" lang="de">

    <label class="form-label" for="muscleInput">Muskelbereich</label>
    <select id="muscleInput">
      <option value="Push">Push</option>
      <option value="Pull">Pull</option>
      <option value="Beine">Beine</option>
    </select>

    <label class="form-label" for="deviceInput">Gerät</label>
    <input type="text" id="deviceInput" placeholder="Gerät">

    <label class="form-label" for="weightInput">Gewicht (kg)</label>
    <div class="weight-control" style="display:flex; gap:10px; align-items:center; margin-bottom:12px;">
      <input type="hidden" id="weightInput" value="20">
      <button id="gearBtn" class="gear-btn" onclick="toggleWeightPicker()" title="Gewicht wählen">⚙</button>
      <div id="weightDisplay" style="font-size:18px;">20 kg</div>
      <div id="weightPicker" class="weight-picker" style="display:none;">
        <div class="spinner">
          <button class="spin-btn" id="spinDown">▼</button>
          <input id="weightSpinnerInput" type="number" min="10" max="150" step="1" value="10">
          <button class="spin-btn" id="spinUp">▲</button>
        </div>
      </div>
    </div>

    <label class="form-label" for="setsCountInput">Sätze</label>
    <div class="weight-control" style="display:flex; gap:10px; align-items:center; margin-bottom:12px;">
      <input type="hidden" id="setsCountInput" value="3">
      <button id="setsGearBtn" class="gear-btn" onclick="toggleSetsCountPicker()" title="Sätze wählen">⚙</button>
      <div id="setsCountDisplay" style="font-size:18px;">3</div>
      <div id="setsCountPicker" class="weight-picker" style="display:none;">
        <div class="spinner">
          <button class="spin-btn" id="setsSpinDown">▼</button>
          <input id="setsCountSpinnerInput" type="number" min="1" max="3" step="1" value="3">
          <button class="spin-btn" id="setsSpinUp">▲</button>
        </div>
      </div>
    </div>

  <!-- Legacy "Wiederholungen" field removed - use "Sätze" und "Wiederholungen pro Set" spinners below -->

    <label class="form-label" for="repsPerSetInput">Wiederholungen pro Set</label>
    <div class="weight-control" style="display:flex; gap:10px; align-items:center; margin-bottom:12px;">
      <input type="hidden" id="repsPerSetInput" value="6">
      <button id="repsGearBtn" class="gear-btn" onclick="toggleRepsPerSetPicker()" title="Wiederholungen wählen">⚙</button>
      <div id="repsPerSetDisplay" style="font-size:18px;">6</div>
      <div id="repsPerSetPicker" class="weight-picker" style="display:none;">
        <div class="spinner">
          <button class="spin-btn" id="repsSpinDown">▼</button>
          <input id="repsPerSetSpinnerInput" type="number" min="1" max="12" step="1" value="6">
          <button class="spin-btn" id="repsSpinUp">▲</button>
        </div>
      </div>
    </div>

    <button class="submit-btn" onclick="addEntry()">Speichern</button>
    <div id="entries"></div>
  </div>

  <!-- Modal für Sätze-Eingabe -->
  <div class="modal-overlay" id="setsModal">
    <div class="modal-box">
      <button class="modal-close-btn" onclick="closeSetsModal()">✕</button>
      <h2 class="modal-header">Anzahl Wiederholungen</h2>
      <div class="sets-input-group">
        <label class="sets-input-label">Wähle die Anzahl der Wiederholungen:</label>
        <div style="display: flex; gap: 16px; margin-top: 16px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="radio" name="repsCount" value="1" id="reps1"> <span style="font-size: 16px;">1x</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="radio" name="repsCount" value="2" id="reps2"> <span style="font-size: 16px;">2x</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="radio" name="repsCount" value="3" id="reps3"> <span style="font-size: 16px;">3x</span>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn modal-btn-cancel" onclick="closeSetsModal()">Abbrechen</button>
        <button class="modal-btn modal-btn-save" onclick="saveSets()">Speichern</button>
      </div>
    </div>
  </div>

  <script>
    let entriesVisible = false;
    let editingEntry = null;
    let currentSetsSets = ''; // Speichert die Sätze für den aktuellen Eintrag
    
    // Kalender-Variablen initialisieren
    let currentViewYear = 2025;  // Startjahr
    let currentViewMonth = 9;    // Startmonat (Oktober = 9)
    
    // Hilfsfunktion: Konvertiere ISO-Datum (2025-01-15) zu deutschem Format (15.01.2025)
    function formatDateGerman(isoDate) {
      if (!isoDate) return '';
      const [year, month, day] = isoDate.split('-');
      return `${day}.${month}.${year}`;
    }
    
    // Hilfsfunktion: Konvertiere deutsches Datum (15.01.2025) zu ISO-Format (2025-01-15)
    function convertGermanToISO(germanDate) {
      if (!germanDate) return '';
      const [day, month, year] = germanDate.split('.');
      return `${year}-${month}-${day}`;
    }
    
    // Lade gespeicherte Einträge beim Start
    window.addEventListener('load', loadEntries);

    // Draft / Auto-Save: speichere laufende Eingaben, damit beim erneuten Öffnen nichts verloren geht
    function saveDraft() {
      const draft = {
        date: document.getElementById('dateInput').value,
        muscle: document.getElementById('muscleInput').value,
        device: document.getElementById('deviceInput').value,
        weight: document.getElementById('weightInput').value,
        setsCount: document.getElementById('setsCountInput').value,
        repsPerSet: document.getElementById('repsPerSetInput').value
      };
      localStorage.setItem('entryDraft', JSON.stringify(draft));
    }

    function restoreDraft() {
      const raw = localStorage.getItem('entryDraft');
      if (!raw) return;
      try {
        const draft = JSON.parse(raw);
        if (draft.date) document.getElementById('dateInput').value = draft.date;
        if (draft.muscle) document.getElementById('muscleInput').value = draft.muscle;
        if (draft.device) document.getElementById('deviceInput').value = draft.device;
        if (draft.weight) {
          document.getElementById('weightInput').value = draft.weight;
          const spinner = document.getElementById('weightSpinnerInput'); if (spinner) spinner.value = draft.weight;
          const disp = document.getElementById('weightDisplay'); if (disp) disp.textContent = draft.weight + ' kg';
        }
        if (draft.setsCount) {
          document.getElementById('setsCountInput').value = draft.setsCount;
          const spinner = document.getElementById('setsCountSpinnerInput'); if (spinner) spinner.value = draft.setsCount;
          const disp = document.getElementById('setsCountDisplay'); if (disp) disp.textContent = draft.setsCount;
        }
        if (draft.repsPerSet) {
          document.getElementById('repsPerSetInput').value = draft.repsPerSet;
          const spinner = document.getElementById('repsPerSetSpinnerInput'); if (spinner) spinner.value = draft.repsPerSet;
          const disp = document.getElementById('repsPerSetDisplay'); if (disp) disp.textContent = draft.repsPerSet;
        }
      } catch (e) {
        console.warn('restoreDraft failed', e);
      }
    }

    function loadEntries() {
      const savedEntries = localStorage.getItem('fitnessEntries');
      if (savedEntries) {
        const entries = JSON.parse(savedEntries);
        const entriesDiv = document.getElementById('entries');
        // Clear existing DOM entries to avoid duplicates
        entriesDiv.innerHTML = '';
        entries.forEach(entry => {
          const entryDiv = createEntryElement(entry);
          entriesDiv.appendChild(entryDiv);
        });
      }
    }

    function saveEntries() {
      const entriesDiv = document.getElementById('entries');
      const entries = [];
      
      // Sammle alle Einträge aus der DOM
      entriesDiv.querySelectorAll('.entry').forEach(entryDiv => {
        const textContent = entryDiv.querySelector('div').textContent;
        // Parse: "15.01.2025 - muscle - device - weight kg - setsCount Sätze - repsPerSet Wiederholungen"
        const parts = textContent.split(' - ');
        if (parts.length >= 6) {
          const germanDate = parts[0].trim();
          const isoDate = convertGermanToISO(germanDate); // Konvertiere 15.01.2025 zu 2025-01-15
          const muscle = parts[1].trim();
          const device = parts[2].trim();
          const weight = parts[3].replace(' kg', '').trim();
          const setsCountStr = parts[4] || '';
          const setsCount = setsCountStr.replace(' Sätze', '').trim();
          const repsPerSetStr = parts[5] || '';
          const repsPerSet = repsPerSetStr.replace(' Wiederholungen', '').trim();
          
          entries.push({ date: isoDate, muscle, device, weight, setsCount, repsPerSet });
        }
      });
      
      // Speichere im LocalStorage
      localStorage.setItem('fitnessEntries', JSON.stringify(entries));
    }

    function createEntryElement(data) {
      const entryDiv = document.createElement('div');
      entryDiv.className = 'entry';
      
      const textDiv = document.createElement('div');
      const formattedDate = formatDateGerman(data.date);
      textDiv.textContent = `${formattedDate} - ${data.muscle} - ${data.device} - ${data.weight} kg - ${data.setsCount || '3'} Sätze - ${data.repsPerSet || '6'} Wiederholungen`;
      
      const buttonsDiv = document.createElement('div');
      buttonsDiv.className = 'entry-buttons';

      const editButton = document.createElement('button');
      editButton.className = 'edit-btn';
      editButton.textContent = 'Bearbeiten';
      editButton.onclick = () => editEntry(data.date, data.muscle, data.device, data.weight, data.setsCount, data.repsPerSet, entryDiv);

      const deleteButton = document.createElement('button');
      deleteButton.className = 'delete-btn';
      deleteButton.textContent = 'Löschen';
      deleteButton.onclick = () => deleteEntry(entryDiv);

      buttonsDiv.appendChild(editButton);
      buttonsDiv.appendChild(deleteButton);
      
      entryDiv.appendChild(textDiv);
      entryDiv.appendChild(buttonsDiv);
      return entryDiv;
    }

    function deleteEntry(entryDiv) {
      // Direkt löschen ohne Bestätigung
      if (!entryDiv) return;
      entryDiv.remove();
      // Aktualisiere den LocalStorage nach dem Löschen
      saveEntries();
    }

    function goToEntry() {
      document.getElementById('startPage').style.display = 'none';
      document.getElementById('entryPage').style.display = 'block';
      document.getElementById('menuBtn').style.display = 'flex';
      updateSidebarEntries();
      updateCalendar();
    }

    // Fallback / simple Implementierung, falls die Sidebar-Update-Funktion fehlt.
    // Aktualisiert hier nur kleine sichtbare Informationen (kann bei Bedarf erweitert werden).
    function updateSidebarEntries() {
      try {
        const monthHistory = document.getElementById('monthHistory');
        if (!monthHistory) return;
        // Zeige eine kurze Info, wie viele Trainingstage aktuell gespeichert sind
        const trainedDays = JSON.parse(localStorage.getItem('trainedDays') || '[]');
        monthHistory.innerHTML = '<h3 style="color: #ff1493; margin: 0 0 10px 0;">Vergangene Monate</h3>' +
          '<div style="color:#666;">Gespeicherte Trainingstage: ' + trainedDays.length + '</div>';
      } catch (e) {
        console.warn('updateSidebarEntries fallback failed', e);
      }
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const menuBtn = document.getElementById('menuBtn');
      
      sidebar.classList.toggle('open');
      
      // Verstecke den Menü-Button wenn Sidebar offen ist
      if (sidebar.classList.contains('open')) {
        menuBtn.classList.add('hidden');
      } else {
        menuBtn.classList.remove('hidden');
      }
    }

    // Klick außerhalb der Sidebar schließt sie
    document.addEventListener('click', function(event) {
      const sidebar = document.getElementById('sidebar');
      const menuBtn = document.getElementById('menuBtn');
      
      if (sidebar.classList.contains('open') && 
          !sidebar.contains(event.target) && 
          !menuBtn.contains(event.target)) {
        sidebar.classList.remove('open');
        menuBtn.classList.remove('hidden');
      }
    });

    function updateCalendar() {
      if (typeof currentViewYear === 'undefined' || typeof currentViewMonth === 'undefined') {
        currentViewYear = 2025;
        currentViewMonth = 9;
      }
      
      const now = new Date();
      const firstDay = new Date(currentViewYear, currentViewMonth, 1);
      const lastDay = new Date(currentViewYear, currentViewMonth + 1, 0);
      
      // Setze Monatsüberschrift
      const months = ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 
                     'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
      document.getElementById('currentMonth').textContent = months[currentViewMonth] + ' ' + currentViewYear;

      // Prüfe ob der Monat vorbei ist und archiviere ihn ggf.
      const isMonthOver = now > lastDay;
      if (isMonthOver) {
        archiveMonth(currentViewMonth, currentViewYear);
      }
      
      const calendar = document.querySelector('.calendar');
      calendar.innerHTML = '';
      
      // Füge Wochentage hinzu
      ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'].forEach(day => {
        const dayEl = document.createElement('div');
        dayEl.className = 'weekday';
        dayEl.textContent = day;
        calendar.appendChild(dayEl);
      });

      // Hole gespeicherte Trainingsdaten
      const trainedDays = JSON.parse(localStorage.getItem('trainedDays') || '[]');
      
      // Füge Tage hinzu
      let dayCount = 1;
      const totalDays = lastDay.getDate();
      const firstWeekday = (firstDay.getDay() + 6) % 7; // Montag = 0

      for (let i = 0; i < 42; i++) {
        const dayEl = document.createElement('div');
        dayEl.className = 'day';
        
        if (i >= firstWeekday && dayCount <= totalDays) {
          const currentDate = new Date(currentViewYear, currentViewMonth, dayCount);
          const dateStr = currentDate.toISOString().split('T')[0];
          
          dayEl.textContent = dayCount;
          
          if (trainedDays.includes(dateStr)) {
            dayEl.classList.add('active');
          }
          
          if (currentDate < now) {
            dayEl.classList.add('past');
          }
          
          if (dayCount === now.getDate() && 
              currentViewMonth === now.getMonth() && 
              currentViewYear === now.getFullYear()) {
            dayEl.classList.add('today');
          }
          
          dayEl.onclick = (e) => toggleTrainingDay(dateStr, e);
          
          dayCount++;
        }
        
        calendar.appendChild(dayEl);
      }
    }

    function changeMonth(delta) {
      currentViewMonth += delta;
      if (currentViewMonth > 11) {
        currentViewMonth = 0;
        currentViewYear++;
      } else if (currentViewMonth < 0) {
        currentViewMonth = 11;
        currentViewYear--;
      }
      
      // Prüfe ob der Monat im erlaubten Zeitraum liegt (Okt 2025 - Sept 2027)
      const currentDate = new Date(currentViewYear, currentViewMonth);
      const minDate = new Date(2025, 9); // Oktober 2025
      const maxDate = new Date(2027, 8);  // September 2027
      
      if (currentDate < minDate) {
        currentViewMonth = 9; // Oktober
        currentViewYear = 2025;
      } else if (currentDate > maxDate) {
        currentViewMonth = 8;  // September
        currentViewYear = 2027;
      }
      
      updateCalendar();
      updateMonthHistory();
    }

    function archiveMonth(month, year) {
      const monthKey = `${year}-${month + 1}`;
      const trainedDays = JSON.parse(localStorage.getItem('trainedDays') || '[]');
      
      // Filtere Tage für diesen Monat
      const monthDays = trainedDays.filter(date => {
        const d = new Date(date);
        return d.getMonth() === month && d.getFullYear() === year;
      });

      // Speichere Monatsstatistik
      const monthArchive = JSON.parse(localStorage.getItem('monthArchive') || '{}');
      monthArchive[monthKey] = {
        trainingDays: monthDays.length,
        dates: monthDays
      };
      
      localStorage.setItem('monthArchive', JSON.stringify(monthArchive));
      
      // Entferne archivierte Tage aus den aktiven Trainingstagen
      const newTrainedDays = trainedDays.filter(date => {
        const d = new Date(date);
        return d.getMonth() !== month || d.getFullYear() !== year;
      });
      
      localStorage.setItem('trainedDays', JSON.stringify(newTrainedDays));
      updateMonthHistory();
    }

    function updateMonthHistory() {
      const monthArchive = JSON.parse(localStorage.getItem('monthArchive') || '{}');
      const container = document.getElementById('monthHistory');
      const months = ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 
                     'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
      
      // Sortiere nach Datum absteigend
      const sortedMonths = Object.entries(monthArchive)
        .sort(([a], [b]) => b.localeCompare(a))
        .slice(0, 12); // Zeige maximal die letzten 12 Monate

      container.innerHTML = '<h3 style="color: #ff1493; margin: 0 0 10px 0;">Vergangene Monate</h3>';
      
      if (sortedMonths.length === 0) {
        container.innerHTML += '<div style="color: #666;">Noch keine abgeschlossenen Monate</div>';
        return;
      }

      sortedMonths.forEach(([key, data]) => {
        const [year, month] = key.split('-').map(n => parseInt(n));
        const monthName = months[month - 1];
        
        const div = document.createElement('div');
        div.className = 'month-history-item';
        div.innerHTML = `
          <span>${monthName} ${year}</span>
          <span class="stats">${data.trainingDays} Trainingstage</span>
        `;
        container.appendChild(div);
      });
    }

    function toggleTrainingDay(date, event) {
      // Verhindere, dass der Klick nach außen propagiert
      event.stopPropagation();
      
      const trainedDays = JSON.parse(localStorage.getItem('trainedDays') || '[]');
      const index = trainedDays.indexOf(date);
      
      if (index === -1) {
        trainedDays.push(date);
      } else {
        trainedDays.splice(index, 1);
      }
      
      localStorage.setItem('trainedDays', JSON.stringify(trainedDays));
      updateCalendar();
      updateMonthHistory();
    }

    function toggleMonthOverview() {
      const content = document.getElementById('monthOverviewContent');
      const icon = document.querySelector('.toggle-icon');
      
      if (content.style.display === 'none') {
        content.style.display = 'block';
        icon.classList.add('open');
        // Aktualisiere Kalender beim Öffnen
        updateCalendar();
        updateMonthHistory();
      } else {
        content.style.display = 'none';
        icon.classList.remove('open');
      }
    }

    // Prüfe beim Laden der Seite, ob wir direkt zur Eingabeseite gehen sollen
    window.addEventListener('load', function() {
      if (sessionStorage.getItem('showEntryPage') === 'true') {
        sessionStorage.removeItem('showEntryPage');
        goToEntry();
      }
      // Initialisiere Monatshistorie
      updateMonthHistory();
      // Initialisiere Spinner
      populateWeightPicker();
      populateRepsPerSetPicker();
      populateSetsCountPicker();
      // Restore draft values so nothing is lost when re-opening
      restoreDraft();
    });
      function populateWeightPicker() {
        // setup spinner input and buttons
        const spinner = document.getElementById('weightSpinnerInput');
        const spinUp = document.getElementById('spinUp');
        const spinDown = document.getElementById('spinDown');
        const hidden = document.getElementById('weightInput');
        const display = document.getElementById('weightDisplay');
        if (!spinner || !spinUp || !spinDown || !hidden) return;

        // Initialize values
        spinner.min = 10;
        spinner.max = 150;
      spinner.step = 2;
      spinner.value = hidden.value || 20;
      display.textContent = spinner.value + ' kg';        // button handlers
        spinUp.onclick = (e) => { e.stopPropagation(); changeSpinnerBy(1); };
        spinDown.onclick = (e) => { e.stopPropagation(); changeSpinnerBy(-1); };

        // input change -> sync hidden and display
        spinner.addEventListener('input', function(e) {
          syncSpinnerToHidden();
        });

        // wheel support (over spinner)
        spinner.addEventListener('wheel', function(e) {
          e.preventDefault();
          const delta = e.deltaY > 0 ? -1 : 1;
          changeSpinnerBy(delta);
        });
      }

      function populateRepsPerSetPicker() {
        // setup spinner input and buttons für Wiederholungen pro Set
        const spinner = document.getElementById('repsPerSetSpinnerInput');
        const spinUp = document.getElementById('repsSpinUp');
        const spinDown = document.getElementById('repsSpinDown');
        const hidden = document.getElementById('repsPerSetInput');
        const display = document.getElementById('repsPerSetDisplay');
        if (!spinner || !spinUp || !spinDown || !hidden) return;

        // Initialize values
        spinner.min = 1;
        spinner.max = 12;
        spinner.step = 1;
        spinner.value = hidden.value || 6;
        display.textContent = spinner.value;

        // button handlers
        spinUp.onclick = (e) => { e.stopPropagation(); changeRepsSpinnerBy(1); };
        spinDown.onclick = (e) => { e.stopPropagation(); changeRepsSpinnerBy(-1); };

        // input change -> sync hidden and display
        spinner.addEventListener('input', function(e) {
          syncRepsPerSetToHidden();
        });

        // wheel support (over spinner)
        spinner.addEventListener('wheel', function(e) {
          e.preventDefault();
          const delta = e.deltaY > 0 ? -1 : 1;
          changeRepsSpinnerBy(delta);
        });
      }

      function populateSetsCountPicker() {
        // setup spinner input and buttons für Sätze
        const spinner = document.getElementById('setsCountSpinnerInput');
        const spinUp = document.getElementById('setsSpinUp');
        const spinDown = document.getElementById('setsSpinDown');
        const hidden = document.getElementById('setsCountInput');
        const display = document.getElementById('setsCountDisplay');
        if (!spinner || !spinUp || !spinDown || !hidden) return;

        // Initialize values
        spinner.min = 1;
        spinner.max = 3;
        spinner.step = 1;
        spinner.value = hidden.value || 3;
        display.textContent = spinner.value;

        // button handlers
        spinUp.onclick = (e) => { e.stopPropagation(); changeSetsSpinnerBy(1); };
        spinDown.onclick = (e) => { e.stopPropagation(); changeSetsSpinnerBy(-1); };

        // input change -> sync hidden and display
        spinner.addEventListener('input', function(e) {
          syncSetsCountToHidden();
        });

        // wheel support (over spinner)
        spinner.addEventListener('wheel', function(e) {
          e.preventDefault();
          const delta = e.deltaY > 0 ? -1 : 1;
          changeSetsSpinnerBy(delta);
        });
      }

      function changeSpinnerBy(delta) {
        const spinner = document.getElementById('weightSpinnerInput');
        if (!spinner) return;
        let step = Number(spinner.step) || 1;
        let val = Number(spinner.value) || 0;
        val += delta * step;
        val = Math.max(Number(spinner.min), Math.min(Number(spinner.max), val));
        spinner.value = val;
        syncSpinnerToHidden();
      }

      function syncSpinnerToHidden() {
        const spinner = document.getElementById('weightSpinnerInput');
        const hidden = document.getElementById('weightInput');
        const display = document.getElementById('weightDisplay');
        if (!spinner || !hidden || !display) return;
        hidden.value = spinner.value;
        display.textContent = spinner.value + ' kg';
      }

      function changeRepsSpinnerBy(delta) {
        const spinner = document.getElementById('repsPerSetSpinnerInput');
        if (!spinner) return;
        let step = Number(spinner.step) || 1;
        let val = Number(spinner.value) || 0;
        val += delta * step;
        val = Math.max(Number(spinner.min), Math.min(Number(spinner.max), val));
        spinner.value = val;
        syncRepsPerSetToHidden();
      }

      function syncRepsPerSetToHidden() {
        const spinner = document.getElementById('repsPerSetSpinnerInput');
        const hidden = document.getElementById('repsPerSetInput');
        const display = document.getElementById('repsPerSetDisplay');
        if (!spinner || !hidden || !display) return;
        hidden.value = spinner.value;
        display.textContent = spinner.value;
      }

      function changeSetsSpinnerBy(delta) {
        const spinner = document.getElementById('setsCountSpinnerInput');
        if (!spinner) return;
        let step = Number(spinner.step) || 1;
        let val = Number(spinner.value) || 0;
        val += delta * step;
        val = Math.max(Number(spinner.min), Math.min(Number(spinner.max), val));
        spinner.value = val;
        syncSetsCountToHidden();
      }

      function syncSetsCountToHidden() {
        const spinner = document.getElementById('setsCountSpinnerInput');
        const hidden = document.getElementById('setsCountInput');
        const display = document.getElementById('setsCountDisplay');
        if (!spinner || !hidden || !display) return;
        hidden.value = spinner.value;
        display.textContent = spinner.value;
      }

      function toggleWeightPicker() {
        const picker = document.getElementById('weightPicker');
        const gear = document.getElementById('gearBtn');
        if (!picker) return;
        if (getComputedStyle(picker).display === 'none') {
            // Zeige inline als flex-Element, damit es direkt neben dem Zahnrad erscheint
            picker.style.display = 'flex';
            picker.style.alignItems = 'center';
            // initialize spinner values when opening
            populateWeightPicker();
          } else {
            picker.style.display = 'none';
          }
      }

      function toggleRepsPerSetPicker() {
        const picker = document.getElementById('repsPerSetPicker');
        const gear = document.getElementById('repsGearBtn');
        if (!picker) return;
        if (getComputedStyle(picker).display === 'none') {
            picker.style.display = 'flex';
            picker.style.alignItems = 'center';
            populateRepsPerSetPicker();
          } else {
            picker.style.display = 'none';
          }
      }

      function toggleSetsCountPicker() {
        const picker = document.getElementById('setsCountPicker');
        const gear = document.getElementById('setsGearBtn');
        if (!picker) return;
        if (getComputedStyle(picker).display === 'none') {
            picker.style.display = 'flex';
            picker.style.alignItems = 'center';
            populateSetsCountPicker();
          } else {
            picker.style.display = 'none';
          }
      }

      // Klick außerhalb schließt Picker (picker is inside weight-control)
      document.addEventListener('click', function(e) {
        const picker = document.getElementById('weightPicker');
        const gear = document.getElementById('gearBtn');
        if (!picker) return;
        // Prüfe das gerenderte display, nicht nur das inline style
        if (getComputedStyle(picker).display !== 'none') {
          const weightControl = document.querySelector('.weight-control');
          if (!weightControl.contains(e.target) && e.target !== gear) {
            picker.style.display = 'none';
          }
        }
      });

      // Klick außerhalb schließt auch den neuen Reps-Picker
      document.addEventListener('click', function(e) {
        const repsPickerElements = document.querySelectorAll('[id="repsPerSetPicker"]');
        if (repsPickerElements.length === 0) return;
        const repsPicker = repsPickerElements[0];
        const repsGear = document.getElementById('repsGearBtn');
        
        if (getComputedStyle(repsPicker).display !== 'none') {
          const repsControl = document.querySelectorAll('.weight-control');
          let foundInControl = false;
          repsControl.forEach(ctrl => {
            if (ctrl.contains(repsPicker) && ctrl.contains(e.target)) {
              foundInControl = true;
            }
          });
          if (!foundInControl && e.target !== repsGear) {
            repsPicker.style.display = 'none';
          }
        }
      });

    function addEntry() {
      const date = document.getElementById('dateInput').value;
      const muscle = document.getElementById('muscleInput').value;
      const device = document.getElementById('deviceInput').value;
      const weight = document.getElementById('weightInput').value;
  const setsCount = document.getElementById('setsCountInput').value;
  const repsPerSet = document.getElementById('repsPerSetInput').value;

      // Markiere den Tag automatisch als Training absolviert
      const trainedDays = JSON.parse(localStorage.getItem('trainedDays') || '[]');
      if (!trainedDays.includes(date)) {
        trainedDays.push(date);
        localStorage.setItem('trainedDays', JSON.stringify(trainedDays));
      }

      if (editingEntry) {
        // Bearbeiten eines bestehenden Eintrags
        const textDiv = document.createElement('div');
        const formattedDate = formatDateGerman(date);
        textDiv.textContent = `${formattedDate} - ${muscle} - ${device} - ${weight} kg - ${setsCount} Sätze - ${repsPerSet} Wiederholungen`;

        const buttonsDiv = document.createElement('div');
        buttonsDiv.className = 'entry-buttons';

        const editButton = document.createElement('button');
        editButton.className = 'edit-btn';
        editButton.textContent = 'Bearbeiten';
        editButton.onclick = () => editEntry(date, muscle, device, weight, setsCount, repsPerSet, editingEntry);

        const deleteButton = document.createElement('button');
        deleteButton.className = 'delete-btn';
        deleteButton.textContent = 'Löschen';
        deleteButton.onclick = () => deleteEntry(editingEntry);

        buttonsDiv.appendChild(editButton);
        buttonsDiv.appendChild(deleteButton);

        editingEntry.innerHTML = '';
        editingEntry.appendChild(textDiv);
        editingEntry.appendChild(buttonsDiv);
        editingEntry = null;
      } else {
        // Neuen Eintrag erstellen
        const entryDiv = document.createElement('div');
        entryDiv.className = 'entry';

        const textDiv = document.createElement('div');
        const formattedDate = formatDateGerman(date);
        textDiv.textContent = `${formattedDate} - ${muscle} - ${device} - ${weight} kg - ${setsCount} Sätze - ${repsPerSet} Wiederholungen`;

        const buttonsDiv = document.createElement('div');
        buttonsDiv.className = 'entry-buttons';

        const editButton = document.createElement('button');
        editButton.className = 'edit-btn';
        editButton.textContent = 'Bearbeiten';
        editButton.onclick = () => editEntry(date, muscle, device, weight, setsCount, repsPerSet, entryDiv);

        const deleteButton = document.createElement('button');
        deleteButton.className = 'delete-btn';
        deleteButton.textContent = 'Löschen';
        deleteButton.onclick = () => deleteEntry(entryDiv);

        buttonsDiv.appendChild(editButton);
        buttonsDiv.appendChild(deleteButton);

        entryDiv.appendChild(textDiv);
        entryDiv.appendChild(buttonsDiv);
        document.getElementById('entries').prepend(entryDiv);
      }

      document.getElementById('entries').style.display = 'block';
      
      // Speichere die aktualisierten Einträge
      saveEntries();

      // Speichere aktuellen Draft nicht zu löschen - wir wollen, dass beim nächsten Öffnen nichts verloren geht
      saveDraft();

      // Felder leeren
      document.getElementById('dateInput').value = '';
      document.getElementById('deviceInput').value = '';
      document.getElementById('weightInput').value = '';
      document.getElementById('setsCountInput').value = '3';
      document.getElementById('setsCountDisplay').textContent = '3';
      document.getElementById('repsPerSetInput').value = '6';
      document.getElementById('repsPerSetDisplay').textContent = '6';
      currentSetsSets = '';
    }

    function editEntry(date, muscle, device, weight, setsCount, repsPerSet, entryDiv) {
      // Daten in die Eingabefelder laden
      document.getElementById('dateInput').value = date;
      document.getElementById('muscleInput').value = muscle;
      document.getElementById('deviceInput').value = device;
      document.getElementById('weightInput').value = weight;
      document.getElementById('setsCountInput').value = setsCount || '3';
      document.getElementById('setsCountDisplay').textContent = setsCount || '3';
      document.getElementById('repsPerSetInput').value = repsPerSet || '6';
      document.getElementById('repsPerSetDisplay').textContent = repsPerSet || '6';
      
      editingEntry = entryDiv;
    }

    function getWeekday(dateString) {
      const date = new Date(dateString);
      const weekdays = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'];
      return weekdays[date.getDay()];
    }
    // öffnet die separate Seite mit den gespeicherten Einträgen
    function openEntriesPage() {
      // wir navigieren zu entries.html (gleicher Ordner)
      window.location.href = 'entries.html';
    }

    // Modal-Funktionen für Sätze-Eingabe
    function openSetsModal() {
      const modal = document.getElementById('setsModal');
      
      // Lade gespeicherte Sätze und setze Radio-Button
      const radios = document.querySelectorAll('input[name="repsCount"]');
      radios.forEach(radio => {
        radio.checked = radio.value === currentSetsSets.replace('x', '');
      });
      
      // Zeige Modal
      modal.classList.add('active');
    }

    function closeSetsModal() {
      const modal = document.getElementById('setsModal');
      modal.classList.remove('active');
    }

    function saveSets() {
      const selectedRadio = document.querySelector('input[name="repsCount"]:checked');
      if (selectedRadio) {
        currentSetsSets = selectedRadio.value + 'x'; // z.B. "1x", "2x", "3x"
      }
      
      closeSetsModal();
    }

    // Klick außerhalb des Modals schließt es
    document.addEventListener('click', function(event) {
      const modal = document.getElementById('setsModal');
      const modalBox = document.querySelector('.modal-box');
      if (modal && modal.classList.contains('active') && !modalBox.contains(event.target)) {
        closeSetsModal();
      }
    });

    // Auto-save: registriere Input-Listener auf Formularfeldern
    const fieldsToWatch = ['dateInput','muscleInput','deviceInput','setsCountSpinnerInput','repsPerSetSpinnerInput','weightSpinnerInput'];
    fieldsToWatch.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('input', function() {
        // sync hidden fields for spinner-driven controls
        if (id === 'weightSpinnerInput') syncSpinnerToHidden();
        if (id === 'setsCountSpinnerInput') syncSetsCountToHidden();
        if (id === 'repsPerSetSpinnerInput') syncRepsPerSetToHidden();
        saveDraft();
      });
      el.addEventListener('change', saveDraft);
    });
  </script>

</body>
</html>
